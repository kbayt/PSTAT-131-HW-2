---
title: "PSTAT 131 HW 2"
author: "Katherine Bayt"
date: '2022-04-10'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(tidymodels)
library(corrplot)
library(ggthemes)
tidymodels_prefer()
library(ISLR)
```

## QUESTION 1

```{r}
abalone1 <- abalone %>%
  mutate(age = abalone$rings + 1.5)
```

```{r echo=FALSE}
abalone1 %>% ggplot(aes(x=age))+ geom_histogram(bins=60)


```

The distribution of age is numeric with a range from 2 to 32. Age has the highest counts at 12, with higher counts to the left of 12, and lower counts to the right os 12. The distribution is right skewed, with a larger range of ages to the right of the highest count age.

## QUESTION 2

```{r}
set.seed(4857)
abalone1$rings = NULL
abalone1_split <- initial_split(abalone1, prop = 0.8,
                               strata = age)
abalone1_train <- training(abalone1_split)
abalone1_test <- testing(abalone1_split)
```

## QUESTION 3

```{r}
albalone1_recipe <- recipe(age ~ ., 
    data = abalone1_train) %>%
    step_dummy(all_nominal_predictors()) %>%
    step_interact(terms=~starts_with("type"):shucked_weight) %>%
    step_interact(terms=~longest_shell:diameter) %>%
    step_interact(terms=~shucked_weight:shell_weight) %>%
    step_normalize(all_predictors())
prep(albalone1_recipe)
```

We should not use rings to predict age because they have a positive correlation of 1. \## QUESTION 4

```{r}
## Create and store a linear regression object
lm_model <- linear_reg() %>%
  set_engine("lm")
```

## QUESTION 5

```{r}
## 1. set up an empty workflow
## 2. add the model you created from 4
## 3. add the recipe you created from 3
lm_wflow <- workflow() %>%
  add_model(lm_model) %>%
  add_recipe(albalone1_recipe)
```

## QUESTION 6

```{r}
lm_fit <- fit(lm_wflow, abalone1_train) 
df <- data.frame(longest_shell = 0.5, diameter = 0.10,
                 height = 0.30,whole_weight = 4,
                 shucked_weight = 1, viscera_weight = 2,
                 shell_weight = 1, type = "F")
predict(lm_fit, new_data = df)
```

I got a prediction of 22.7.

## QUESTION 7

```{r}
abalone_train_res <- predict(lm_fit, new_data = abalone1_train %>%
                               select(-age))
abalone_train_res <- bind_cols(abalone_train_res,
                               abalone1_train %>% select(age))
abalone_train_res %>% head()

abalone_metrics <- metric_set(rmse, rsq, mae)
abalone_metrics(abalone_train_res, truth = age, estimate = .pred)
```

\`\`\`{r}
